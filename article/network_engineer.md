---
title: 计算机网络
date: 2020-12-22 20:22:11
categories:
- study
---
# 计算机网络基础

## 进制转换

十进制：89D；
八进制：89O；
十六进制：89H；
>二进制数1101.01转化成十进制
`1101.01（2）=1*2^0+0*2^1+1*2^2+1*2^3 +0*2^(-1)+1*2^(-2)=1+0+4+8+0+0.25=13.25（10）`

- 十进制整数转换为二进制整数采用"除2取余，逆序排列"法。具体做法是：用2整除十进制整数，可以得到一个商和余数；再用2去除商，又会得到一个商和余数，如此进行，直到商为小于1时为止，然后把先得到的余数作为二进制数的低位有效位，后得到的余数作为二进制数的高位有效位，依次排列起来。


- 十进制小数转换成二进制小数采用"乘2取整，顺序排列"法。具体做法是：用2乘十进制小数，可以得到积，将积的整数部分取出，再用2乘余下的小数部分，又得到一个积，再将积的整数部分取出，如此进行，直到积中的小数部分为零，此时0或1为二进制的最后一位。或者达到所要求的精度为止。

- 整数二进制转八进制：从右往左每三位二进制转1位八进制，不足三位在左边补零；反之八进制转二进制，每一位八进制转换为三位二进制

- 整数二进制转十六进制:从右往左每四位二进制转1位十六进制，不足四位在左边补零；反之十六进制转二进制，每一位十六进制转换为四位二进制
>[0~9,a-f]

最高位为符号位：1表示负数，0表示正数  
反码：正数原码反码一样，负数符号位不变，其他取反  
补码：正数原码补码一样，负数在反码的基础上加1，由补码求原码则是先取反再加1  
>计算机中一般采用补码进行存储，因为补码和移码的0是唯一，补码可以直接带符号运算而不出现错误

取值范围：
原码：-[2^(n-1)-1]\~2^(n-1)-1
反码：-[2^(n-1)-1]\~2^(n-1)-1
补码：-2^(n-1)~2^(n-1)-1

### 逻辑运算

- 或：有1则为1
- 与：全1才为1
- 非：取反
- 异或：不相同才为1

### 计算机结构
- 总线：数据总线，地址总线，控制总线；
- 主机：
   1. 主存储器
   2.cpu
      * 运算器
         1. 算术逻辑单元ALU
         2. 累加寄存器AC:暂存计算结果
         3. 数据缓冲寄存器
         4. 状态条件寄存器
      * 控制器
         1. 程序计数器PC:储存指令地址
         2. 指令寄存器IR
         3. 指令译码器
         4. 时序部件

- 寻址方式：
一条指令包括操作码和地址码
1. 立即寻址
2. 内存寻址
   * 变址寻址
   * 直接寻址
   * 间接寻址
3. 寄存器寻址与寄存器间接寻址

- CISC(复杂)与RISC(精简)
* CISC:
* RISC:统一指令编码、泛用的寄存器、单纯的寻址方式、寻址方式少、硬件中支持少数资料类型。指令长度固定、指令种类尽可能少。增加寄存器数目减少访存次数。

- 流水线：

取址-》分析-》执行
流水线执行时间计算公式：`(t1+t2+t3)+(n-1)t1`
(t1+t2+t3)为一条指令顺序执行时间即取址、分析、执行的时间之和。t1为三个步骤中执行时间最长的一段
吞吐率：指令条数/流水线执行时间
加速比：不使用流水线的时间/使用流水线的执行时间

### 存储容量单位

主存(内存):RAM随机存储器，掉电丢失；ROM只读存储器，掉电不丢失；
缓存cache：缓和寄存器与内存间的速率矛盾；
Cache是一个高速小容量的临时储存器，其容量远远小于内存，cpu先访问Cache再访问内存，如果数据在cache中为命中，在内存中为不命中，
>Cache的访问命中率为h，Cache访问周期为t1，主存器访问时间为t2；整个系统的平均访存时间为`h* t1+(1-h)*t2`

地址范围：末地址-首地址+1
>注意：二进制10-1=1

位：bit
字节：1B=8bit
字：通常为字节的整数倍

1K=2^10b
1M=2^10K
1G=2^10M

磁盘容量/物理块大小=物理块个数
物理块个数/字长（一个字需要的物理块=位示图大小需要的字
（物理块大小*系统字长*磁盘容量)/物理块=物理块大小*磁盘容量

- 磁盘：
RAID技术:
1. RAID0:将所有硬盘构成一个磁盘阵列。写入速度快，不具备备份和容错能力；可靠性最差;利用率为100%
2. RAID1:磁盘镜像技术，将一个硬盘的内容同步备份到另一个硬盘；具备容错和备份能力；效率不高，可靠性好；利用率为50%
3. RAID3:奇偶校验盘的分段技术；容错性好，可靠性高；单块硬盘失效时会出现I/O瓶颈。有一块磁盘用于存放校验数据所以利用率=（n-1）/n
4. RAID5:分布式奇偶校验技术，校验值分布在各盘的不同位置；性能比RAID3好;利用率一样
5. RAID6:带有两个独立分布式校验方案的独立数据磁盘；能实现两个磁盘掉线容错；磁盘利用率（n-2）/n

DMA存取方式是一种完全有硬件执行I/O数据交换的工作方式，它即考虑到中断的响应，又要节约中断开销。此时，DMA控制器代替CPU完全接管对总线的控制，数据交换不经过CPU，直接在内存和外围设备之间进行数据交换

- 进程管理
等待，就绪，运行

- 死锁：一个进程在等待一个不可能发生的事就会出现死锁
解决死锁：
1. 预防死锁
2. 死锁避免
   * 银行家算法
3. 死锁检测
4. 死锁解除

- pv操作：
解决进程互斥同步问题
P操作：使s=s-1若s>=0则进程继续执行，否则进入等待队列；
V操作：使s=s+1若s<=0则唤醒等待队列中的一个进程

- 软件开发模型：
瀑布模型
v模型
喷泉模型
螺旋模型
### 网络按分布范围分类

局域网(误码率最小)，城域网，广域网

### 网络按拓扑结构分类

总线型、星型、环型、树形、网状型、混合型

### OSI七层模型


|osi层次|封装单位|地址标识|功能|
|-:|:-:|:-:|:-:|
|物理层|比特流|Bit|定义物理设备接口链路标准,用于建立、维护、拆除物理链路链接，确保原始数据在物理媒介上的传输|
|数据链路层|数据帧|MAC地址|在物理层提供的比特流的服务上，建立相邻结点间的数据链路，通过差错控制提供数据帧在信道上的无差错的传输，功能有物理寻址，比特流封装成帧，帧同步，差错、流量控制|
|网络层|数据包，分组|IP地址|基于IP地址进行不同网络间的路径选择，网络寻址|
|传输层|数据段|端口号|定义了传输数据的协议与端口，提供端与端可靠的数据传输，分段与重组|
|会话层|应用进程|进程号|会话的连接与释放,同步|
|表示层|应用进程|进程号|数据解释，数据加密，数据压缩|
|应用层|应用进程|进程号|用户应用程序的协议|

OSI网络管理标准中的5大功能：配置管理、故障管理、性能管理、安全管理、计费管理；

### tcp/ip四层模型

|层|常见协议|
|-|-|
|网络接口层(物理层和数据链路层)|以太网、令牌环、帧中继、ATM|
|网络层|IP、ICMP、IGMP、ARP、RARP|
|传输层|tcp udp|
|应用层|tcp:pop3(110)、ftp(20、21)、http(80)、HTTPS(443)、telent(23)、SMTP。udp：DHCP、DNS(53)、SNMP(161、162)、TFTP(69)。共用：NFS、Samba等。|

**数据的封装：**

||||
|-|-|-|
|上层数据|应用层|HTTP FTP TFTP SMTP SNMP DNS|
|tcp头部+上层数据|传输层|TPC UDP|
|ip头部+tcp头部+上层数据|网络层|ICMP iGMP IP ARP RARP|
|MAC头部+ip头部+tcp头部+上层数据|数据链路层|由底层网络定义协议|
|二进制数据|物理层|由底层网络定义的协议|

#### OSI模型服务访问点

- 垂直方向：
---
>服务用户：  第n+1层 实体（n+1）
---
>服务提供者：第n层  实体（n）
---

- 常见访问点SAP:
1. 数据链路层：LLC地址
2. 网络层：IP地址
3. 传输层：端口号


## 物理层
### 时延

1. 发送时延=数据帧长度(bit)/发送速率(bit/s)
2. 传播时延=信道长度(m)/电磁波在信道上的传播速率(m/s)；电磁波的传输速率为光速；铜线为2.3*10^8m/s；光纤/电缆为2*10^8m/s;卫星信号的传播延迟为270ms。
3. 处理时延
4. 排队时延


### 传输介质
1. 双绞线：屏蔽双绞线（stp）非屏蔽双绞线（utp）；  
双绞线线序：T568A,T6568B;  
双绞线两端使用相同标准称为直通线，否则称为交叉线； 

|设备互联|线缆种类|
|-|-|
|计算机--计算机|交叉线|
|计算机--交换机|直通线|
|计算机--路由器|交叉线|
|交换机--交换机|交叉线|
|交换机--路由器|直通线|
|路由器--路由器|交叉线|

2. 同轴电缆
有很好的抗干扰性，常用于高数据传输；单工通信：无线广播
3. 光纤

单模单纤: 激光二极管LED做光源;传播距离远，数据传输速率高，信号衰减小；造价高  
多模光纤：发光二极管LED做为光源;反之  


#### 信道

- 信道带宽W:模拟信道`W=f2-f1`（f2、f1分别表示信道能通过的最高|最低频率，单位为hz）
- 码元：即一个数字脉冲
- 一个码元携带的信息量n与码元种类N的关系：`n=log(2)N`
- 码元速率（波特率）B：单位时间内信道传输的码元个数，若码元宽度（脉冲周期）为T，则码元速率`B=1/T`,单位为波特Baud
- 无噪声影响：（尼奎斯特定理）信道带宽为W,最大码元速率为`B=2W`;数据极限传输速率为`R=Blog(2)N=2Wlog(2)N`其中N为码元种类数
- 噪声影响：(香农理论)信道的极限传输传输速率为：`C=Wlog(2)(1+S/N)`;W：带宽；S:信号平均功率；N:噪声平均功率；
由于信噪比S/N的比值通常太大，因此通常用分贝db来表示,分贝与信噪比的转换公式：db=10log(s/n);常见的：`db=30 => S/N=1000`;`log(2)1001=log(2)1024=10`;

- 信道复用：发送端复用器，接收端分用器；频分复用FDM、时分TDN、波分WDM、吗分CDM

- 调制与解调

|数据种类|模拟信道|数字信道|
|-|-|-|
|模拟数据|调幅AM、调频FM、调相PM、正交调相QAM|*PCM脉冲编码调制*：采样(奈奎斯特定理)、量化(如：量化128个信道=2^7==7bit)、编码|
|数字数据|调制：ASK(码元种类：2),FSK(码元种类：2),PSK(码元种类：2),DPSK(码元种类：2)、4DPSK(码元种类：4)、QPSK(码元种类：4)|基本编码，应用型编码|

- E1:
E1载波有32个信道，30个用来传数据，2个不传，即控制率为`2/32*100%`,基本帧传送时间为125us;数据速率为2.048Mb/s,每个信道的速率是64Kb/s
E2信道由4个E1信道组成，数据速率为8.448Mb/s.
- T1：
T1载波控制位为24+1位，总帧长为`24*（7+1）=193`速率为1.544Mb/s
T2信道由4个T1信道组成，数据速率为6.312Mb/s
>异步通信中，每个字符包含一位起始位、7位数据位、1位奇偶位、一位终止位，每秒传送100个字符，采用DPSK调制，则码元速率位1000波特，有效数据速率为700bps

采取pcm编码,信道的数据速率为`采样率*每次采样所占位数`

- 编码：
1. 不归零制：高电平为1，低电平为0；
2. 归零制：正脉冲为1，负脉冲为0；
3. 曼切斯特编码：在中心周期由高电平向低电平跳变为1，反之变为0；
4. 差分曼切斯特编码：边界处有跳变为0，没有为1；

应用型编码：
1. 曼切斯特编码（常用于10M以太网）和差分曼特斯特编码（常用于令牌环网），编码效率只有50%
2. 8B/6B:100Base-T,
3. 4B/5B编码：常用于100base-x，编码效率为80%
4. 8B/10B编码：千兆以太网，编码效率为80%

>在采用曼斯特编码方式的数字通信中，传输一个比特需要发送2个码元，波特率是数据速率的2倍

|标准|频段|技术|速率|
|-|-|-|-|
|802.11|2.4GHz的ISM频段|扩频通信技术|1mbps|
|802.11b|2.4GHz的ISM频段|CCK技术|11mbps|
|802.11a|5GHz的U-NII频段|OFDM调制技术|54mbps|
|802.11g|2.4GHz的ISM频段|OFDM调制技术|54mbps|
|802.11n|2.4GHz和5GHz|MIMO,OFDM|600mbps|


### 接入技术
- 常见接入网技术:SONET/SDH
SONET信号STS-1和OC-1的速率:51.840Mb/s
SONET信号STS-3、OC-3与SDH信号STM-1的速率:155.520Mb/s
1. 窄带（N-ISDN）用户利用2B+D数字用户线拨号上网
2. xDSL：各种DSL数字用户线的总称，通过频分复用技术，利用电话线传输数字数据。
   - IDSL：数字用户线路，128kbps，对称模式
   - HDSL:对称,上下行1.544Mb/s
   - SDSL:对称,上下行2.3Mb/s
   - *ADSL：非对称用户数字线路，采用频分多路复用技术DMT，非对称模式。下行8Mbps，下640kbps-1Mbps*
   - VDSL：超高数据速率数字用户线路，非对称模式,上8Mb/s,下640kbps-1Mbps
3. 局域网接入
4. HFC光纤同轴混合网：电缆调制解调器:利用有线电视电缆
5. FTTX:光纤接入技术:为了有效利用光纤资源，会在光纤干线与广大用户之间铺设一段管线转换器，即ODN光配线网，使得十几个用户共同享用一条光纤干线，无源的光配线网称为无源光网络：
-  无源光网络PON：
ODN光分配网络，没有有源电子设备，避免电磁干扰；下行采用TDM广播方式，上行采用TDMA时分多址接入方式

PON三种类型：
1. APON:以53字节固定长度的ATM信元方式传输
2. EPON：基于以太网的PON技术，可变长度的分组进行
3. GPON： 上下行传输不对称，兼容上面两种；

## 数据链路层
两种协议：ppp、CSMA/CD协议；
三个问题：封装成帧、透明传输、差错控制；
以太网MAC层的硬件地址；

#### 封装成帧
1. 把网络层交下来的IP数据报添加首部和尾部封装成帧；
2. 把封装好的数据帧发送给结点B的数据链路层；
3. 若结点B的数据链路层收到的帧无差错，则从帧中提取IP数据报交给网络层，否则丢弃该帧；

帧的首部和尾部的作用是确定帧的界限即帧定界
为了提高帧的传输效率，应使帧的数据长度尽可能大于首部和尾部的长度。而规定数据部分长度的上限称为最大传送单元MTU；
帧定界可以使用特殊的帧定界符：帧开始SOH、帧结束EOT；

- MAC帧组成(最小64字节)：6B`目的地址`，6B`源地址`，2B`类型(上层协议类型)`，网络层的`数据`46\~1500字节(不够时填充0保持最小帧长,46字节是最小帧长64字节减去首尾一共18字节而得的)，4B`FCS(CRC校验）`;即合法帧长为64\~1518字节
>规定最小帧长为64位，避免发送过程中检测不到冲突，若帧长不够则填充冗余字节到最小帧长

#### 透明传输

数据链路层的透明传输指无论什么样的比特组合的数据，都能够按照原来没有差错的通过这个数据链路层；
避免非ASCII吗的的文本文件中的某个字节的二进制代码恰好和SOH、EOT这种控制字符一样；发送端会在数据部分的SOH、EOT、ESC等控制字符的前面插入一个转义字符“ESC”,接受端收到后会删除该字符在交给网络层，此方法称为字符填充
#### 差错控制：
任意两个码字之间最少变化的二进制位数称为该数据编码的最小码距

在一个码组内为了检测e个误码，最小码距应满足：`d>=e+1`;
在一个码组内为了纠正t个误码，则最小码距应满足：`d>=2t+1`

- 奇偶校验：
奇偶校验是最简单的错误检测码，是一个给定位数的二进制数中1的个数是奇数或偶数的二进制数。如果传输过程中包括校验位的奇数或者偶数个数据位发生改变，那么奇偶校验位将出错。奇偶检验位是一种检错码，但不能确定具体哪一位出错，所以无法纠正。
检错码=信息字段+校检字段；
>奇偶校验用的是模二加运算法则
   1. 垂直奇偶校验（纵向奇偶校验）
   2. 水平奇偶校验（横向奇偶校验）
- 海明校验：
海明码特点：`m+k+1<=2^k` m为数据位数，k为冗余码个数，海明码存放的位置在2^n上，如：`4位冗余码==p1p2c1p3c2c3c4p4c5c6....`能纠错一位.

- CRC校验
生成多项式的最高次幂为冗余码个数
如:P(x)=x^4+x^2+1;则冗余码为4个，即在发送的帧后面添加4个0；除数为10011；
模二运算法则,相同为0，不同为1

循环冗余检验一般不进行纠错，若数据出错则请求重传。


### 点对点协议PPP
### CSMA/CD协议:载波监听多点接入/碰撞检测

使用CSMA/CD协议时，一个站不可能同时进行发送和接受，所以使用该协议的以太网只能进行半双工通信。

- 载波监听过程
   1. 非坚持型监听算法：空余时立即发送，忙时放弃监听，随机后退一段时间再监听(信道利用率低)
   2. 1-坚持型监听算法：空时立即发送，忙时继续监听(减少发送延迟，发生冲突的概率大）
   3. P-坚持型监听算法：空时根据概率p决定是否发送，忙时继续监听（算法复杂）

- 冲突检测方法
边发边听:碰撞窗口（争用期）=2倍传播时延；`发送时延>=2*传播时延`所以最短帧长计算：`发送时延>=2*传播时延`;

- 发现冲突，停止发送
- 随机延迟重发
采用截断二进制指数退避算法：
   1. 确定基本退避时间即2倍传播时延
   2. k=Min[重传次数,10],从集合[0,1,3,....,((2^k)-1)]中随机区一个数，乘于2倍传输时延，
   3. 当重传16次仍不成功，则丢弃
>第n次重传后再发生冲突的概率：`1/2^(n+1)`

#### MAC地址:一般采用16进制表示
（硬件唯一标识地址）MAC地址： 48位；前24位为供应商标志；第8位I/G位为1表示组播地址,用于多播(一对多,广播为一对全体)，为0表示单播地址。后一半为网卡的唯一编码；
### 局域网
局域网分类：
- 以太网
- 令牌环网
- ATM网
- 无线局域网
- FDDI网
### 局域网设备

1. 集线器：物理层
2. 网桥：数据链路层；生成树网桥、源路由网桥；
3. 交换机：数据链路层；
4. 路由器：网络层

>网桥根据MAC帧的目的地址对帧进行转发和过滤
>交换机根据以太网帧中的目的地址智能转发数据，只能分割冲突域,交换机分割冲突域，实现全双工通信，不使用CSMA/CD协议。交换机级联可在不同厂家的设备间使用，而堆叠只能在通厂家间的设备进行；路由器能分割冲突域和广播域，集线器啥都不能；

交换机与路由器相关参数计算：
背板带宽=端口数*相应端口速率*2（全双工模式）  
包转发率=千兆端口数量*1.488Mpps+百兆端口数量*0.1488MPPS+其余端口数*相应速率

### 无线局域网

|种类|标准|应用|
|-|-|-|
|无线个人网WPAN|IEEE802.15|蓝牙|
|无线局域网WLAN|IEEE802.11|企业|
|无线城/广域网WMAN|IEEE802.20&&蜂窝通信|访问internet|

无线局域网中的AP的轮询会锁定异步帧，在IEEE802.11网络中定义了无争用服务机制来解决这问题。

- 加密
WEP：对称加密算法；
WPA:
WPA2:AES加密算法；


### 流量和差错控制

停等协议
滑动窗口协议
停等ARQ协议:应答帧大小为64B；
选择重发(SR)：其最大值就是最小帧编号总数的一半即`W发=W收<=2^(k-1)`
后退N帧(GBN):限制发送窗口的大小为`W<=2^k-1`; 接收窗口=1

### 以太网标准

1. 以太网：早期的局域网标准802.3，速率10Mbps。最小帧长64B，最大帧长1518B。10Basc-T：无屏蔽双绞线，曼切斯特编码，半双工模式

2. 快速以太网：802.3u标准，速率100Mbps，最小帧长64B，最大帧长1518B。
100Base-T4:4对3类非屏蔽双绞线，最大长度100m，三对数据传输，一对冲突检测；8B/6T编码；半双工模式。
100Base-T2:2对3类UTP，100m
100Base_TX:2对5类非屏蔽双绞线，一对发，一对收，4B/5B与MLT-3编码，全双工模式。
100Base-FX:一对光纤，最大长度45m，一发一收，4B/5B编码；全双工

3. 千兆以太网：速率1000Mbps，最小帧长512B,最大帧长1518B。
1000 Base-T:(802.3ab标准)非屏蔽双绞线，PAM5编码 100米。
1000 Base-X:全双工，半双工，多模光纤；8B/10B编码，
   - 1000 Base-CX:屏蔽双绞线，25m；802.3z标准，
   - 1000 Base-LX:单模光纤，3km；802.3z标准，
   - 1000 Base-SX:多模光纤，300m-500m；802.3z标准，

4. 万兆以太网:只工作在*全双工模式*；802.3ae标准，最小帧长64B，最大1518B。64B/66B编码；光纤；



### VLAN

基于802.1Q标准，每个交换机所有端口都处于广播域，交换机所有端口默认属于VLAN1。VLAN:把同一物理局域网内的不同用户，在逻辑上划分成不同的广播域。VLAN的取值范围为0-4095；

- access接口为数据打上VLAN id，用于交换机连接终端设备，只允许一个VLAN帧通过。
- trunk链路可以放行多个VLAN的流量，用于交换机之间连接。允许多个VLAN通过，除缺省VLAN外其它VLAN都带有标签通过trunk端口。
- hybrid端口：允许一个或多个VLAN的帧通过，可以选择是否带标签。

>VLAN静态划分的方式是按端口划分的。

- GARP通用属性注册协议
GVRP协议：VLAN注册协议
   *交换机端口模式：*
   1. Normal模式：允许该端口动态注册或注销VLAN，传播动态或静态VLAN信息；
   2. Fixed模式：禁止该端口动态注册或注销VLAN，只传播静态VLAN信息；
   3. Forbidden模式：禁止该端口动态注册或注销VLAN，除VLAN1外，不传播任何VLAN信息；
---
VLAN trunk（vlan中继）指在交换机之间或交换机与路由器之间连接的情况下，在互相连接的端口上配置中继模式，使得属于不同vlan的数据帧都可以通过这条中继链路进行传输。

- VTP指VLAN中继协议,用于交换机设置VLAN。有三种工作模式：
1. 服务模式：可设置VLAN信息，服务器自动广播所以VLAN信息到其他交换机
2. 客户模式:不能配置VLAN信息，只能接受服务器的VLAN配置。
3. 透明模式：可以配置vlan信息，但不广播自己的vlan信息，接受服务器vlan配置信息后不使用，而是直接转发给其他交换机。

交换机初始工作在透明模式下，这个模式下有一个默认的VLAN，所有的端口都属于这个VLAN
VTP修剪的作用是减掉不必要的trunk链路上的广播，以提升整个交换网的性能和带宽


- 生成树协议：STP
删除交换机之间的网络环路，逻辑上断开环路，防止广播风暴的产生,增加了带宽，提高了网络的可靠性。

   1. 选择根网桥：交换机之间选择网桥ID值最小的。网桥ID组成：网桥优先值2字节（取值范围0~65535，默认32768，越小优先级越高）+网桥mac地址6字节；
   2. 选择根端口：从非跟网桥上选择，本端口到根网桥路径成本最低，带宽越小开销越小。网桥ID最小，端口ID最小。端口ID=端口优先级(默认128)+端口编号
   3. 选择指定端口：根桥上的端口全是指定端口，所以还需要在非根网桥上选择指定端口，端口所在的网桥路径成本最低，网桥ID较小，端口ID较小。

- 快速生成树协议：RSTP

   1. rstp端口角色：根端口，指定端口，替代端口，备份端口；
替换端口是对根端口的备份，备份端口是指定端口的备份
   2. rstp端口状态：丢弃，学习，转发。
rstp快速收敛机制：
   1. 边缘端口机制
   2. 根端口快速切换机制
   3. 指定端口快速切换机制

- 多生成树协议：MSTP
基于实例计算出多棵生成树

#### 以太网通道

多条链路负载均匀，提高带宽，容错率。
LACP链路聚合控制协议
PAGP端口聚合协议

### 广域网
- 交换方式：电路交换，报文交换、分组交换（虚电路、ATM、IP数据报）

- 广域网技术：

   1. HDLC:面向*比特*的高级数据链路控制协议，是思科私有协议;头尾8bit为01111110;

   >HDLC中控制字段中第一，二位表示传送帧的类型：第一位为0表示信息帧（I帧），第一，二位为“10”是监控帧（S帧），S帧不带信息字段，“11”为无编号帧（U帧）。第三，四位S帧类型的编码“00”接受就绪（RR）；“01”拒绝（REJ）:用于要求发送方从编号为N开始的帧及其以后的所有的帧进行重传；“10”接收未就绪（RNR）:表示编号小于N的帧已被收到，但目前处于正忙状态，尚未准备好接受第N的帧；“11”选择拒绝（SREJ）:表示其他帧已接收但第N帧需要重发。

   2. PPP协议：点对点协议，面向*字符*；只检错，不纠错，没有流量控制。提供了一整套协议框架来解决链路建立配置、维护、拆除、上层协议协商和认证等问题；ppp验证方法：密码验证协议PAP、挑战式握手验证协议CHAP。
>PPPoE为宽带上网的主机使用的链路层协议

- 常见广域网协议：
   1. X.25:使用电话或ISDN设备作为网络硬件设备来构架广域网，建立虚电路，实现可靠交付；
   2. 帧中继：第二层建立虚拟电路，只检错，不重传，没有流量控制，但有拥塞控制，把复杂的检错交个高层处理；
   3. ATM异步传输网络：面向连接，将数据分割成固定长度的信元.(采用固定53字节来进行帧分割，称为信元)。采用统计时分复用TDM技术。使用虚电路的虚通路VPI和虚信道VCI作为链路标识.数据速率为155Mb/s
   4. IP数据报

- 流量控制：
   1. 停等协议：
   2. 滑动窗口协议：
   3. 停等ARQ协议
   4. 选择重发ARQ：其最大值小于帧编号总数的一半，即W发=W收<=2^(k-1)
   5. 后退N帧ARQ：限制发送窗口大小为W<=(2^k)-1,(K为帧编号的位数）

## 网络层

#### IP网际协议

IP地址组成：`网络号`+`主机号`
组成：首部+数据部分；

>首部固定20字节,最多60字节，

||||||
|-|-|-|-|-|
|版本4位（ipv4、ipv6）|首部长度4位（二进制5-15）|区分服务8位|总长度16位(首部和数据)||
|标识16位(判断是否为同一个数据报)|||标志2位(MF=1表示后面还有分片，DF=0表示允许分片)|片偏移14位(字节，从数据部分开始)|
|生存时间8位(TTL没经过一个路由器就-1)|协议8位(TCP、UDP)||首部校验和16位(只校验首部)||
|||源地址32位|||
|||目的地址32位|||

### ipv4

ipv4使用32位（四字节）地址。


||范围|说明|
|-|-|-|
|A类地址(0....)|1.0.0.0-127.255.255.255|可用网络号为2^7-1即126个，网络号全0为保留地址，指本网络，网络号127用于环回测试；可用主机号为2^24-2,主机号全0表示该IP地址为本主机所连接到的单个地址，主机号全1表示该网络上的所有主机|
|B类(10...)|128.0.0.0-191.255.255.255|可用网络号为2^14-1,因为前两位固定为10，128.0.0.0保留，不可指派；主机号同理|
|C类(110..)|192.0.0.0-223.255.255.255| 前三位固定110，192.0.0.0不指派，即可用网络号为2^21-1|
|D类(1110...)（组播）|224.0.0.1-239.255.255.254||
|E类（保留）|240.0.0.0-255.255.255.255||
0.0.0.0-0.255.255.255

>私有地址--NAT--公有地址

- ipv4私有地址范围：

A类中：10.0.0.0-10.255.255.255(网络号：10，网络数：1）

B类：172.16.0.0-172.31.255.255(网络号：172.16\~172.31，网络数：16）

C类：192.168.0.0-192.168.255.255(网络号：192.168.0\~192.168.255，网络数：256）

- 特殊地址：

`0.0.0.0`:在本网络上的本主机，目的地址不可以使用，源地址可以使用

`127.0.0.1`:本地环回地址，用于本地测试

`255.255.255.255`：全网广播地址，源地址不可以使用，目的地址可以；

`169.254.0.0/16`：本地链接地址段

`169.254.x.x/16`:自动专用IP地址（APIPA）

>子网掩码是用来标识两个IP地址是否同属于一个子网。32位长的二进制数值；为1则代表该位是网络位；为0则表示该位是主机位；


- 单播地址：
- 组播地址：tcp/ip协议使用的以太网多播地址块范围为224.0.0.0-239.255.255.255；组播地址只能用于目的地址，不能用于源地址
- 广播地址：

### ipv6
- 优点：
更大的地址空间:128位地址
更灵活的首部格式等

- 地址表示：16进制
   - 删除一个或多个前导零，零连续部分用双冒号表示，但只能使用一次
   - 每个设备在启用ipv6时会自动配置一个链路本地地址：`FE80::110`,其用于邻居发现，因为ipv6中没有了广播，ARP协议不能用。链路本地地址以`FE80`开头，路由器不会转发链路本地地址
   - 环路地址：`::1`
   - 多播地址：`FF00::`

- ipv6地址类型：
   - 单播：48位全球路由选择器前缀+16位子网标识符+64位接口标识符（mac地址）
   - 多播：组播地址在ipv6包中不能用作源地址。
   - 任播：用来标识一组网络接口，路由器会将目标地址是任播地址的数据包发给距本路由最近的一个网络接口；

- ipv6特殊地址
   1. 与ipv4兼容地址：0:0:0:0:0:0:w.x.y.z
   2. ipv4映射地址：0:0:0:0:0:FFFF:w.x.y.z

- ipv6协议过渡方案：
双协议栈，隧道技术，网络地址转换技术；


#### 子网划分:可变长子网掩码(VLSM)

*子网划分：使两级ip地址变成三级ip地址；只是把主机号这部分进行再划分，增加了灵活性，减少了主机总数*
IP地址={《网络号》，《子网号》，《主机号》}
>进行子网划分后，路由器提取数据报首部提取IP地址与子网掩码相与（一一为一）；

* 无分类编址CIDR记法：
消除了传统A、B、C类网络以及子网划分的概念：IP地址={《网络前缀》，《主机号》}
>如192.168.1.0/26，其网络位是26位，主机位为6位，主机全为0是网络ID,不是有效主机地址；主机位全为1为此网络ID的广播地址；有效主机IP数量为2^m-2;

- 路由汇聚：选择网络地址相同的位进行汇聚，不同的位划分至主机位，从而实现将多个网段汇聚成一个新的超网网段。
最佳路由匹配原则：查找路由表时应当选择具有最长前缀的路由，网络的前缀越长，其地址块越小。

>使用路由汇聚时，路由表中的每个项目由‘网络前缀’和‘下一条地址’组成，因此查找路由表时可能会得到不止一个匹配结果，此时应当选择具有最长网络前缀的路由，因为网络前缀越长，其地址块越小，因而路由就越具体。

路由汇聚是把小网段中网络位一模一样的位数全部保留，网络位不一样的全部变成主机位；汇聚后主机位有32-n位；其中有效地址个数为2的n次方减2。

汇聚地址块120.64.4.0/22的ip地址范围为120.64.4.0/22-120.64.7.255/22其中120.64.6.0/22为汇聚网络ID，120.64.7.255/22为广播地址



### 网际控制报文协议ICMP
>封装在IP数据报中，作为数据部分

- ICMP差错报告报文：
   - 终点不可达
   - 时间超过
   - 参数问题
   - 改变路由
- ICMP询问报文：
   - 回送请求与问答
   - 时间戳请求与问答

1. 对ICMP差错报告报文不再发送ICMP差错报告报文
2. 对特殊地址0.0.0.0或127.0.0.0等的数据报不发送ICMP差错报告报文
3. 对具有多播地址的数据报不发送
4. 对第一个分片的数据报片的所有后续数据报片都不发送

- 应用：
   - ping命令
   - traceroute、tracert命令

### IGMP:网际组管理协议
IP多播需要使用网际组管理协议IGMP和多播路由选择协议


### ARP地址解析协议
ARP位于OSI模型的网络层。ARP从已知的IP地址中找到主机的硬件地址。一台设备将数据报发送到另一台设备之前，它会查看其ARP缓存以查看目标设备是否存在MAC地址和相应的IP地址。如果没有，源设备将发送广播地址给网络中的每一台设备，每个设备都将自己的IP地址与其进行比较，只有具有匹配IP地址的设备才会回复包含该设备MAC地址的数据包，然后源设备会添加目标设备MAC地址放入到ARP表以供参考。


>ARP协议数据封装在以太帧中进行传输，ICMP协议数据封装在IP数据包中，RIP封装在UDP报中。
### 路由协议

>互联网太过于庞大，因此划分为许多较小的自治系统AS。

* 静态路由协议

配置形式：目标网络+对应掩码+下一跳地址（本地出接口）
动态路由协议

- RIP路由协议：距离矢量路由协议。基于UDP的520端口发送信息；路由协议优先级为100；经过节点最多不能超过15跳，经16跳的任何分组都将被路由器丢弃；只会和邻居路由器交换路由表信息；路由器更新周期为30s.每次路由更新最多承载25调路由；解决路由环路的方法:水平分割；毒性反转；触发更新；抑制计时器。

- 距离向量算法：
   1. 收到邻居路由表时，邻居路由表跳数全部+1，下一跳路由器为它自己。
   2. 与自己路由表比较，目的地址下一跳为它的，则更新跳数，不论多少。
   3. 目的地址下一跳不是它的，则比较跳数,谁短要谁。
   4. 条目没有的则直接添加

||RIPv1|RIPv2|
|-|-|-|
|有无路由协议|有|无|
|是否支持可变子网掩码VLSM与CIDR|否|是|
|是否支持认证|否|是|
|更新类型|广播|组网|

- OSPF路由协议: 

链路状态路由器协议；OSPF报文封装在IP层，协议号为89作为标识，优先级为10。OSPF路由器所发的信息是与本路由相邻的所有路由器的链路状态。每个路由器都存在有全网的链路状态信息。当链路发生变化时才用泛洪法发送LSU分组更新路由链路信息。通过244.0.0.5与244.0.0.6发送hello报文(LSA分组)确定邻居路由是否连通（默认10s）。OSPF采用Dijkstra算法计算最佳路径.

ospf将自治系统划分为多个区域，每个区域被指定了一个32位的区域标识符，可用点分十进制表示，如0.0.0.0。单域ospf网络只有主干区域网络（配置成区域0）。OSPF的区域分为五种：
1.标准区域：可接受任何链路更新信息和路由汇总信息
2.主干区域：其他区域都通过主干区域交换路由信息。主干区域拥有标准区域的所有性质
3.存根区域：不接受本地自治系统以外的路由信息，对自治系统以外的区域的目标采用默认路由0.0.0.0

OSPF协议相对于RIP的优势：没有跳数的限制，支持可变长子网掩码。支持网络规模大，收敛速度快。不过RIP2也支持可变长子网掩码（VLSM）


- OSPF定义了4种网络：
1. 广播多址网络：具有共享介质的局域网(以太网Ethernet、 Token Ring、FDDI)
2. 非广播多址网络：通过组播的方式传播信息(X.25、Frame Relay、SMDS；)
3. 点到点网络：点到点可字节交换路由信息(PPP、HDLC、)
4. 点到多网络：把非广播网络当作多条点对点网络来使用，从而把一条路由信息发送到不同目标(RARP)


3. BGP路由协议；边界网关协议。采用路径向量路由协议，寻找较好的路由。适用于自治域（AS）间的路由。通过TCP，179端口建立关系；封装在tcp报文中。防环机制：EBGP=>通过AS-Path属性防环；IBGP=>;

## 传输层

### UDP协议
特点：无连接，尽最大努力交付，面向报文，首部开销小（8字节），支持1对多,没有拥塞控制，

*首部（源端口2字节，目的端口2字节，长度2字节(数据长度)，校验和2字节）+数据*

UDP检验，添加伪首部，变成二进制，相加后取反放入校验和。
### TCP
特点：面向连接，每一条连接只有两个端点，可靠交付，全双工通信，面向字节流

- TCP连接的端点叫套接字：socket=（IP地址：端口号）
TCP连接={socket1，socket2}

- 可靠传输：
   - 停止等待协议：发送一个分组停止发送，等待对方确认后再发送下一个分组。
   - 连续ARQ协议（滑动窗口）(后退N帧)：同时发送多个分组，每收到一个确认就把发送窗口移动一个分组。接收方收到多个分组，会对按序到达的最后一个分组发送确认表示前面的分组已经正确收到。缺点：当中间分组丢失时，会抛弃之后的分组，对前面的分组发送确认。发送方需要把之后的重新发送。

- 首部（最小20字节)+数据

|||||
|-|-|-|-|
||源端口16位|目的端口16位||
||序号32位(一个字节流中每一个字节都按序编号)|||
||确认号32位(期待对方下一个报文段的第一个数据字节的序号)|||
|数据偏移4位(距离首部开头)|保留4位|2位:ACK（为1时确认号才有效）、URG（为1时，紧急指针才有效）、PSH（尽快交付给上层应用）、RST（TCP连接出现严重错误时重新建立连接）、SYN（建立连接时用来同步序号，置1表示连接请求）、FIN（置1表示释放连接）|窗口16位(自己的窗口)|
||校验和16位|紧急指针16位(紧急数据字节数、位置)||


三次握手，四次断开
>客户端收到服务器发送的释放连接报文后，必须对此发送确认。并且经过时间等待计时器（TIME-WAIT)设置的时间2MSL（最长报文段寿命）后，客户端才进入关闭状态。
- 状态：
   - `LISTEN`:服务器等待连接 
   - `SYN_SENT`:客户端发起连接，
   - `SYN_RCVD`:服务器收到SYN包
   - `ESTABLISHED`:完成三次握手，可以开始传输数据

- 流量控制：可变窗口(单位位字节）
- 拥塞和控制：
判断网络拥塞的依据就是出现*超时*
   - 慢开始，拥塞避免，
      1. 刚开始发送时设置初始拥塞窗口为1到2个发送方最大报文段（SMSS）
      2. 慢开始：从0以指数增长
      3. 拥塞避免：到达初始拥塞窗口则成线性增长
      4. 网络拥塞即遇到超时，初始拥塞窗口设置为出现拥塞时的1/2
      5. 从0进行慢开始
   - 快重传，快恢复
      1. 快重传： 执行拥塞避免时一连收到3个同样的ack，则初始拥塞窗口设置为当前的1/2
      2. 快恢复：从初始拥塞窗口开始，继续执行拥塞避免

### 传输层端口(16位)
- 熟知端口：0~1023
`ftp`：数据20，控制21
`tftp`:69
`http`：80
`https`：443
`telnet`：23
`SMTP`：25
`pop3`:110
`DNS`:53
`DHCP`：服务端67，客户端68
`SNMP`：udp协议；轮询161端口,发送请求和应答，陷阱162
- 登记端口：1024\~49151
- 客户端端口：49152\~65535

### DNS域名系统

- 名称解析的方法：Host表、DNS系统

DNS系统实现将域名和ip地址进行映射，提供解析的分布式数据库服务

- 分类：
主域名服务器（权威域名服务器）
辅助域名服务器（从域名服务器）
转发域名服务器

- 解析过程：
本地解析，迭代解析，递归解析

- 资源记录：
SOA:定义该区域中的哪个名称服务器为主域名服务器（权威域名服务器）
NS:表示该区域中的所有域名服务器
A：列出域名到IP地址的映射
PTR：IP地址到域名的映射
MX：邮件交换器信息
CNAME：别名记录

### DHCP服务
客户端（68）服务端（67）
`Dhcpdiscover`：客户端ip租用请求
`Dhcpoffer`:服务端分配ip
`Dhcprequest`:客户端接受
`Dhcpack`:服务端确认
`Dhcpdecline`:客户端发现服务端分配的ip无法使用

### 服务质量QOS
用来解决网路延迟和阻塞问题的一种技术。用于区分流量，保证重要流量及时被转发
1. 尽力而为服务模型：先进先出
2. 综合服务模型：提前申请网络资源
3. 区分服务模型: 不预留资源，通过多种方式之指定报文的QOS

### 电子邮件服务
客户端：发送STMP-》STMP-》接收POP3
网页：http-》STMP-》http
- pops:电子邮件客户端上的操作不反馈到服务器上
- IMAP：能同步到服务器上

- MIME:多用途互联网邮件扩展，支持图片，视频，声音

### HTTP协议
HTTP的URL的一般协议:`http://主机:端口/路径`

1. 浏览器分析超链接指向页面的URL.
2. 浏览器向dns请求解析网址
3. 域名系统dns解析出网址的ip地址
4. 浏览器与服务器建立TCP连接
5. 浏览器发出取文件命令:GET/xx/index.htm
6. 服务器给出响应
7. TCP连接释放
8. 浏览器显示页面

### 网络安全

1. 系统病毒：传染性，潜伏性，破坏性。前缀：win95
2. 网络蠕虫：不需要用户触发，基本模块：目标搜索模块，攻击模块；前缀worm
3. 木马：隐蔽性，木马本身不带有破坏性，服务端位于被攻击的主机上,用于夺取计算机控制权。前缀：Trojan
4. 后门：一般在黑客初次取得控制权后，留下后门便于下次入侵。前缀：Backdoor
5. 黑客：前缀：Hack
6. 宏病毒：只感染office。前缀：macro
7. vb脚本病毒：浏览器，前缀：script

### 网络攻击

1. 主动攻击：
   1. 拒绝服务攻击DOS：消耗资源，破坏配置如ping泛洪、缓冲区溢出、
ARP欺骗攻击：通过wireshark中的协议这栏，看到有大量ARP报文，说明可能遭遇ARP病毒的攻击。可通过`arp -s`设置静态储存表解决。
   2. 分布式拒绝服务DDOs：控制一些计算机后，向攻击目标统一发起拒绝服务攻击（SYNFlooding)
   3. ping of Death攻击：通过ping发送的ICMP的echo请求消息
2. 被动攻击：

收集信息而不进行访问：嗅探、信息收集、端口扫描

### 网络安全设备

1. 防火墙： 具有访问控制功能，内容控制功能；对内部网络的攻击无能为力。
2. IDS入侵检测系统：积极主动的安全防护工具，只能发出警告
3. IPS入侵防护系统：提供实时的防护，自动拦截

### 加密技术
- 对称加密(加密秘钥与解密秘钥相同,秘钥需要事先约定或通过信使传送或用高度安全的密钥分配中心KDC分配):(数字加密标准)DES(56位）、(三重DES)3DES（第一次和第三次加密秘钥一样,112位）、IDEA、AES
- 非对称加密(公钥密码体系):RSA、ECC、Rabin、EIGamal、背包加密
   - 数字签名：基于非对称加密(私钥生成)，主要用于报文鉴定，不可否认、报文完整性
报文摘要算法：MD5：128位输出。SHA：160位输出
   - 数字证书(数字标识):由证书鉴证机关（CA）签发的对用户*公钥*的认证。采用X.509 V3标准，内容包含：公钥、发行者签名、证书序列号等
- 安全协议SSL：功能有SSL服务器鉴别、加密的SSL会话、SSL客户鉴别
- 安全协议PGP：对邮件报文摘要加密后组成的报文再次进行加密，然后传输。pgp不是一种完全的非对称加密体系，它是由一个对称加密算法IDEA,一个非对称加密算法RSA，一个单向散列算法MD5组成的混合加密算法。
- SNMPv3把对网络协议的安全威胁分为主要和次要两类：
主要：
修改信息，
假冒
修改报文流
消息泄露
次要：
拒绝服务
通信分析。

### 知识产权
- 产权人的确定：
利用单位的物质条件进行创作、或有合同约定、或在本职工作中活动的结果：除署名权外其他著作权归单位。
本职工作中作出的发明、离职一年内、履行本职工作之外的任务所作出的发明：单位享有专利

- 保护期限：
公民的署名权、修改权、完整权没有限制,发表权、使用权、获得报酬权为死后50年
单位的发表权、使用权、获得报酬权为50年
注册商标有效期为10年，发明专利权为20年、实用新型和外观设计专利为10年


### 常见命令


- Pathping :显示通信线路上每个子网的延迟和丢包率
- Nslookup:用于查询internet域名信息或诊断dns服务器问题的工具
- netstart 
`-r命令`：显示路由记录
`a`:显示所有连接和监听端口
`-e`:显示以太网统计信息
`-s`:显示按协议统计信息
`-n`:以数字形式显示地址和端口号
`-o`：显示与每个连接相关的所属进程ID
- Tracert：跟踪路由,通过多次向目标发送ICMP回声（echo）请求报文，每一次增加IP头中的TTL字段的值，从而确定到达各个路由器的时间。
`-d`不进行名字解析，只显示中间节点的IP地址
- route print；查看路由表命令
- ping：发生ICMP回声请求报文检验与另一个计算机的连接
`-t`:持续发送请求，直到Ctrl+C
`-l`:显示目标IP域名：指定数据包大小
`-a`:用ip地址表示目标，进行反向主机名字解析
`-n 数字`:说明发送回声请求的次数，默认4次

- ipconfig
`/all`:显示本机TCP/IP配置
`/release`:DHCP客户端手动释放IP地址
`/renew`:DHCP客户端手动向服务器刷新请求
`/flushdns`:清除本地DNS缓存内容
`/displaydns`:显示本地DNS缓存内容
- route:添加路由

#### linux

- 目录

   - /etc/hosts:配置ip地址和对应主机名的文件
   - /etc/hostname:系统的主机名称，域名
   - /etc/resolv.conf:为DNS的配置文件
   - /etc/gateway:路由表文件
   - /etc/inetd.conf:是tcp/ip服务配置文件
   - /etc/lilo.conf:加载配置为你阿基诺
   - /etc/httpd/conf/httpdxonf:Web服务器主配置文件

- 命令

查看文件内容:
   - cat：一次性全部输出
   - more：分页
   - less：可上下移动一行



### 综合布线系统

- 工作区子系统：连接用户终端设备的子系统，如电脑和网线接口之间的部分
- 水平子系统：连接工作区与主干的子系统，如楼层弱电井里的配线架到每个房间的网卡接口之间的部分。(插座接口到配线架之间）
- 管理子系统：对布线电缆进行端接及配置管理的子系统，如配线间中的设备部分(配线架)
- 干线子系统：连接管理间、设备间的子系统，如将接入层交换机连接到分布层交换机的网络线路(楼层之间）
- 设备间子系统：核心交换机所在的位置就是设备间(机房）
- 建筑群主干子系统：地下管道、直埋沟内、架空(建筑之间)



